# Pocket Holdem 产品需求文档 (PRD)

> 本文档是 Java 重构版的产品需求规范，内容继承自原 TypeScript 版本。

---

## 一、产品定位

一款极致轻量化的、专为熟人社交设计的 **"在线自动发牌器"**。

- **核心逻辑**: 只记分，不涉及任何金融、充值或虚拟货币兑换。

---

## 二、产品目标

- **零成本接入**: 无需下载，H5 环境（微信/浏览器）点开即玩。
- **极致公平**: 纯服务器端校验逻辑，杜绝前端抓包看牌。
- **稳定体验**: 完善的断线重连机制，适配朋友局碎片化操作场景。

---

## 三、核心价值

解决线下聚会没有筹码、洗牌慢、计算底池混乱的痛点，提供比商业 App 更私密、无广告、无门槛的竞技环境。

---

## 四、目标用户

- 有线下组局习惯、因异地或时间碎片化需要线上辅助的朋友团体。
- 追求纯粹德州竞技，不需要复杂社交和商业功能的硬核玩家。

---

## 五、使用场景

- 朋友聚会时，手机化身"筹码栈"与"发牌员"。
- 微信语音开黑，网页端同步进行牌局竞技。

---

## 六、MVP 范围

### 包含
- 完整德州扑克规则（含 **边池算法**）
- 30秒强制倒计时
- 房间系统
- 断线重连
- 淘汰观战

### 不包含
- 充值、Rebuy（补币）
- 在线聊天、表情包
- 战绩统计
- 多底池回放
- AI 机器人

---

## 七、功能设计说明

### 7.1 房间系统

| 功能 | 说明 |
|------|------|
| 参数设置 | 房主创建时设置"初始筹码"、"大小盲注" |
| 房号管理 | 随机 6 位数字房号，支持链接分享 |
| 席位控制 | 6-9 人桌，房主可踢人 |
| 座位锁定 | 游戏进行期间，玩家席位状态锁定 |

### 7.2 玩家系统

| 功能 | 说明 |
|------|------|
| 身份识别 | 仅需输入昵称，系统生成 UUID |
| 淘汰机制 | 筹码归零标记为 `ELIMINATED`，保留座位但不参与发牌 |

### 7.3 德州扑克玩法逻辑

| 功能 | 说明 |
|------|------|
| 标准规则 | 两张底牌 + 五张公共牌 |
| 牌型比拼 | 10 种标准牌型自动判定 |
| 边池逻辑 | 多人 All-in 时自动拆分主池与边池 |
| 庄位轮换 | 每局结束后顺时针移动到下一个非淘汰玩家 |

### 7.4 游戏节奏

| 功能 | 说明 |
|------|------|
| 强制时限 | 30 秒 |
| 视觉提示 | 活动玩家头像框高亮，伴有倒计时进度条 |

### 7.5 同步机制

| 功能 | 说明 |
|------|------|
| 服务端权威 | 所有洗牌、下注计算、胜负判定均在后端完成 |
| 信息遮蔽 | 严禁下发其他玩家的 `holeCards` 数据 |

---

## 八、交互流程设计

### 8.1 房间创建流程
```
进入首页 → 点击"创建房间" → 设置初始筹码 & 盲注 → 生成房间 → 分享链接
```

### 8.2 加入房间流程
```
点击链接/输入房号 → 输入昵称 → 手动点击空位坐下
```

### 8.3 开始游戏流程
```
房主点击"开始游戏" → 后端判定人数(≥2人) → 自动扣除大小盲 → 发放底牌
```

### 8.4 断线重连流程
```
页面刷新/网络重连 → 客户端上报 UUID → 后端匹配房间状态 → 全量下发当前战局快照
```

### 8.5 超时行为
- **情况 A（无需跟注）**: 系统自动执行 **Check**
- **情况 B（需要跟注）**: 系统自动执行 **Fold**

---

## 九、技术约束

| 约束 | 说明 |
|------|------|
| 高并发 | 需保证下注操作的原子性（使用锁机制） |
| 实时性 | 状态变更需毫秒级推送到所有客户端 |
| 跨端 | 必须兼容微信小程序环境（使用 STOMP 协议） |

---

## 十、风险与对策

| 风险 | 对策 |
|------|------|
| 安全性 | 禁止前端持有洗牌结果，防止通过控制台查看底牌 |
| 幂等性 | 下注指令携带 `roundIndex`，防止"双倍下注" |
| 法律规避 | 页面显著位置标注"仅供记分娱乐" |

---

## 十一、测试重点

1. **边池正确性**: 3人以上 All-in 时筹码分配
2. **断线重连**: 在下注轮中间刷新页面，UI 是否完美恢复
3. **并发下注**: 两人同时点击按钮时的先后判定
4. **庄位轮换**: 玩家离开/淘汰后，庄位是否正确跳过

---

## 十二、MVP 验收标准

1. 6 人同时在线测试，完整打完 10 局无崩溃
2. 30 秒超时逻辑能正确触发 Check/Fold
3. 输光筹码后能以观战者身份留在桌上
4. 手机端布局无遮挡、无滚动条错位

---

## 十三、后续迭代预留 (非 MVP)

- **Redis 持久化**: 应对服务器意外重启
- **Rebuy 机制**: 房主可为淘汰玩家"充值"筹码
- **保险算法**: 处理 All-in 时的胜率保护
- **历史牌谱**: 记录每一局的流水
